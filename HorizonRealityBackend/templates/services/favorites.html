{% extends 'base.html' %}
{% load static %}

{% block title %}My Favorite Properties - Horizon Reality{% endblock %}

{% block content %}
<style>
:root {
    --primary-gradient: linear-gradient(135deg, #ffc107 0%, #ff8f00 100%);
    --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    --card-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    --card-hover-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
    --border-radius: 16px;
    --heart-gradient: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
    --pink-gradient: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
    --blue-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --section-padding: clamp(40px, 8vw, 80px);
    --container-padding: clamp(16px, 4vw, 24px);
    --card-padding: clamp(20px, 4vw, 32px);
    --gap-small: clamp(8px, 2vw, 16px);
    --gap-medium: clamp(16px, 3vw, 24px);
    --gap-large: clamp(24px, 5vw, 40px);
}

/* Container System */
.container {
    width: min(100%, 1200px);
    margin-inline: auto;
    padding-inline: var(--container-padding);
}

/* Toast Notifications */
.toast-container {
    position: fixed;
    inset-block-start: clamp(10px, 2vw, 20px);
    inset-inline-end: clamp(10px, 2vw, 20px);
    inset-inline-start: clamp(10px, 2vw, auto);
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: clamp(8px, 2vw, 12px);
    max-inline-size: min(calc(100vw - 20px), 400px);
    inline-size: auto;
}

.toast {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%);
    backdrop-filter: blur(20px);
    color: #2c3e50;
    padding: clamp(16px, 3vw, 20px);
    border-radius: var(--border-radius);
    box-shadow: var(--card-shadow);
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-inline-size: min(280px, 100%);
    max-inline-size: 100%;
    border: 1px solid rgba(255, 255, 255, 0.2);
    transform: translateX(120%) scale(0.8);
    transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.4s;
    opacity: 0;
    word-wrap: break-word;
}

.toast.show {
    transform: translateX(0) scale(1);
    opacity: 1;
}

.toast-content {
    display: flex;
    align-items: center;
    gap: clamp(12px, 2vw, 15px);
    flex: 1;
    min-inline-size: 0;
}

.toast-content span {
    font-size: clamp(14px, 2.5vw, 16px);
    line-height: 1.4;
    word-wrap: break-word;
}

.toast-content i {
    font-size: clamp(20px, 4vw, 24px);
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    flex-shrink: 0;
}

.toast-close {
    cursor: pointer;
    font-size: clamp(18px, 3vw, 20px);
    color: #7f8c8d;
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    padding: 4px;
    border-radius: 50%;
    flex-shrink: 0;
    margin-inline-start: 8px;
}

.toast-close:hover {
    color: #2c3e50;
    background: rgba(0, 0, 0, 0.05);
}

/* Heart Animations */
@keyframes heartBeat {
    0% { transform: scale(1) rotate(0deg); }
    15% { transform: scale(1.3) rotate(-5deg); }
    30% { transform: scale(1.1) rotate(5deg); }
    45% { transform: scale(1.25) rotate(-3deg); }
    60% { transform: scale(1.05) rotate(2deg); }
    75% { transform: scale(1.15) rotate(-1deg); }
    100% { transform: scale(1) rotate(0deg); }
}

@keyframes heartPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.favorite-btn.active i {
    background: var(--secondary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: heartBeat 0.8s ease-in-out;
}

.favorite-btn i {
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    font-size: clamp(18px, 3vw, 20px);
}

.favorite-btn:hover i {
    animation: heartPulse 1s infinite;
}

/* Hero Section */
.hero-section {
    background: var(--primary-gradient);
    position: relative;
    padding-block: var(--section-padding);
    overflow: hidden;
    min-block-size: clamp(300px, 40vh, 500px);
    display: flex;
    align-items: center;
}

.animated-background {
    position: absolute;
    inset: 0;
    z-index: 2;
    pointer-events: none;
}

/* Floating Elements */
.floating-element {
    position: absolute;
    color: rgba(255, 255, 255, 0.4);
    pointer-events: none;
    animation-timing-function: ease-in-out;
    animation-iteration-count: infinite;
    will-change: transform;
}

.floating-heart {
    font-size: clamp(1.2rem, 3vw, 2rem);
    animation: floatHeart 8s infinite;
}

.floating-heart.small {
    font-size: clamp(0.8rem, 2vw, 1.2rem);
    opacity: 0.3;
    animation-duration: 10s;
}

.floating-heart.large {
    font-size: clamp(1.8rem, 4vw, 2.8rem);
    opacity: 0.6;
    animation-duration: 6s;
}

.floating-house {
    font-size: clamp(1rem, 2.5vw, 1.5rem);
    animation: floatSway 12s infinite;
    opacity: 0.2;
}

.floating-star {
    font-size: clamp(0.8rem, 2vw, 1.2rem);
    animation: twinkle 4s infinite;
    opacity: 0.4;
}

.floating-key {
    font-size: clamp(0.9rem, 2.2vw, 1.3rem);
    animation: floatRotate 15s infinite;
    opacity: 0.25;
}

@keyframes floatHeart {
    0%, 100% {
        transform: translateY(0px) rotate(0deg) scale(1);
        opacity: 0.4;
    }
    25% {
        transform: translateY(-20px) rotate(-2deg) scale(1.05);
        opacity: 0.6;
    }
    50% {
        transform: translateY(-10px) rotate(2deg) scale(0.95);
        opacity: 0.8;
    }
    75% {
        transform: translateY(-25px) rotate(-1deg) scale(1.1);
        opacity: 0.5;
    }
}

@keyframes floatSway {
    0%, 100% {
        transform: translateX(0px) translateY(0px) rotate(0deg);
        opacity: 0.2;
    }
    33% {
        transform: translateX(15px) translateY(-10px) rotate(1deg);
        opacity: 0.3;
    }
    66% {
        transform: translateX(-10px) translateY(-5px) rotate(-1deg);
        opacity: 0.25;
    }
}

@keyframes twinkle {
    0%, 100% {
        opacity: 0.4;
        transform: scale(1) rotate(0deg);
    }
    50% {
        opacity: 0.8;
        transform: scale(1.2) rotate(180deg);
    }
}

@keyframes floatRotate {
    0%, 100% {
        transform: translateY(0px) rotate(0deg);
        opacity: 0.25;
    }
    50% {
        transform: translateY(-15px) rotate(180deg);
        opacity: 0.4;
    }
}

@keyframes heartPop {
    0% {
        transform: scale(0) rotate(0deg);
        opacity: 0;
    }
    50% {
        transform: scale(1.3) rotate(-10deg);
        opacity: 1;
    }
    100% {
        transform: scale(0.8) rotate(5deg);
        opacity: 0;
    }
}

.heart-pop {
    position: absolute;
    color: #ff6b6b;
    font-size: clamp(1.5rem, 4vw, 2.5rem);
    animation: heartPop 2s infinite;
    pointer-events: none;
}

/* Gradient Orbs */
.gradient-orb {
    position: absolute;
    inline-size: clamp(60px, 12vw, 120px);
    block-size: clamp(60px, 12vw, 120px);
    border-radius: 50%;
    opacity: 0.1;
    animation: floatOrb 20s infinite ease-in-out;
    filter: blur(1px);
}

.orb-1 {
    background: var(--heart-gradient);
    inset-block-start: 20%;
    inset-inline-start: 10%;
    animation-delay: 0s;
}

.orb-2 {
    background: var(--pink-gradient);
    inset-block-start: 60%;
    inset-inline-end: 15%;
    animation-delay: -7s;
}

.orb-3 {
    background: var(--blue-gradient);
    inset-block-end: 30%;
    inset-inline-start: 20%;
    animation-delay: -14s;
}

@keyframes floatOrb {
    0%, 100% {
        transform: translateY(0px) translateX(0px) scale(1);
    }
    33% {
        transform: translateY(-30px) translateX(20px) scale(1.1);
    }
    66% {
        transform: translateY(10px) translateX(-15px) scale(0.9);
    }
}

/* Hero Content */
.hero-content {
    position: relative;
    z-index: 3;
    text-align: center;
    color: white;
    inline-size: 100%;
}

.hero-content h1 {
    font-size: clamp(2rem, 6vw, 3.5rem);
    font-weight: 700;
    margin-block-end: clamp(16px, 3vw, 20px);
    background: linear-gradient(135deg, #ffffff 0%, rgba(255, 255, 255, 0.8) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: fadeInUp 1s ease-out;
    line-height: 1.2;
}

.hero-content p {
    font-size: clamp(1rem, 3vw, 1.3rem);
    opacity: 0.9;
    font-weight: 300;
    animation: fadeInUp 1s ease-out 0.2s both;
    line-height: 1.5;
    max-inline-size: min(600px, 100%);
    margin-inline: auto;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Breadcrumb */
.breadcrumb-section {
    background-color: #ffffff;
    padding-block: clamp(30px, 6vw, 50px);
    border-block-end: 1px solid #e9ecef;
    margin-block-start: clamp(60px, 10vw, 80px);
    box-shadow: 0 2px 10px rgba(0,0,0,0.02);
}

.breadcrumb {
    margin-block-end: 0;
    padding: 0;
    background: transparent;
    display: flex;
    flex-wrap: wrap;
    gap: clamp(8px, 2vw, 12px);
}

.breadcrumb-item {
    font-size: clamp(12px, 2.5vw, 14px);
    font-weight: 500;
    position: relative;
    display: flex;
    align-items: center;
}

.breadcrumb-item + .breadcrumb-item {
    padding-inline-start: clamp(12px, 3vw, 24px);
}

.breadcrumb-item + .breadcrumb-item::before {
    content: "\F285";
    font-family: "bootstrap-icons";
    color: #ccc;
    font-size: clamp(10px, 2vw, 12px);
    padding-inline-end: clamp(12px, 3vw, 24px);
}

.breadcrumb-item a {
    color: #666;
    text-decoration: none;
    transition: color 0.3s ease;
    display: flex;
    align-items: center;
}

.breadcrumb-item a:hover {
    color: #ff9d1f;
}

.breadcrumb-item.active {
    color: #ff9d1f;
    font-weight: 600;
}

.breadcrumb-home-icon {
    margin-inline-end: clamp(4px, 1vw, 6px);
    font-size: clamp(14px, 3vw, 16px);
}

.breadcrumb-item a::after {
    content: "";
    display: block;
    inline-size: 0;
    block-size: 2px;
    background: #ff9d1f;
    transition: inline-size 0.3s;
    position: absolute;
    inset-block-end: -3px;
    inset-inline-start: 0;
}

.breadcrumb-item a:hover::after {
    inline-size: 100%;
}

/* Properties Section */
.properties-section {
    padding-block: var(--section-padding);
    background: linear-gradient(135deg, #fafbfc 0%, #f1f3f4 100%);
    min-block-size: 60vh;
}

.section-header {
    text-align: center;
    margin-block-start: clamp(30px, 5vw, 40px);
    margin-block-end: var(--gap-large);
    animation: fadeInUp 0.8s ease-out;
}

.section-header h2 {
    font-size: clamp(2rem, 5vw, 2.8rem);
    font-weight: 700;
    margin-block-end: clamp(12px, 2vw, 16px);
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    background-clip: text;
    line-height: 1.2;
}

.section-header p {
    font-size: clamp(1rem, 2.5vw, 1.2rem);
    color: #6c757d;
    font-weight: 300;
    line-height: 1.5;
    max-inline-size: min(500px, 100%);
    margin-inline: auto;
}

/* Properties Found */
.properties-found {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-block-end: var(--gap-large);
    padding: var(--card-padding);
    background: white;
    border-radius: var(--border-radius);
    box-shadow: var(--card-shadow);
    border: 1px solid rgba(0, 0, 0, 0.05);
    animation: slideInLeft 0.8s ease-out 0.3s both;
    flex-wrap: wrap;
    margin-block-start: clamp(-60px, -8vw, -40px);
    gap: var(--gap-medium);
}

.properties-found p {
    margin: 0;
    font-size: clamp(1rem, 2.5vw, 1.1rem);
    font-weight: 500;
    color: #2c3e50;
    line-height: 1.4;
}

.properties-found .count {
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 700;
    font-size: clamp(1.1rem, 3vw, 1.3rem);
}

.view-options {
    display: flex;
    gap: 4px;
    background: #f8f9fa;
    padding: 4px;
    border-radius: 10px;
    border: 1px solid rgba(0, 0, 0, 0.05);
    flex-shrink: 0;
}

.view-btn {
    background: transparent;
    border: none;
    padding: clamp(8px, 2vw, 12px) clamp(12px, 3vw, 16px);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    color: #6c757d;
    font-size: clamp(16px, 3vw, 18px);
    min-inline-size: 44px;
    min-block-size: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.view-btn.active {
    background: var(--primary-gradient);
    color: white;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.view-btn:hover:not(.active) {
    background: rgba(0, 0, 0, 0.05);
    color: #495057;
}

@keyframes slideInLeft {
    from {
        opacity: 0;
        transform: translateX(-30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

/* Responsive Grid - Container Query Alternative */
.properties-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(300px, 100%), 1fr));
    gap: var(--gap-medium);
    margin-block-end: var(--gap-large);
}

/* Property Cards */
.property-card {
    background: white;
    border-radius: var(--border-radius);
    overflow: hidden;
    box-shadow: var(--card-shadow);
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    border: 1px solid rgba(0, 0, 0, 0.05);
    animation: fadeInUp 0.8s ease-out;
    position: relative;
    inline-size: 100%;
    max-inline-size: 100%;
}

.property-card::before {
    content: '';
    position: absolute;
    inset-block-start: 0;
    inset-inline: 0;
    block-size: 4px;
    background: var(--primary-gradient);
    transform: scaleX(0);
    transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.property-card:hover {
    box-shadow: var(--card-hover-shadow);
    transform: translateY(clamp(-4px, -1vw, -8px));
}

.property-card:hover::before {
    transform: scaleX(1);
}

.property-image {
    position: relative;
    block-size: clamp(200px, 30vw, 250px);
    overflow: hidden;
    inline-size: 100%;
}

.property-image img {
    inline-size: 100%;
    block-size: 100%;
    object-fit: cover;
    transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.property-card:hover .property-image img {
    transform: scale(1.05);
}

.property-tags {
    position: absolute;
    inset-block-start: var(--gap-small);
    inset-inline-start: var(--gap-small);
    display: flex;
    gap: var(--gap-small);
    z-index: 2;
    flex-wrap: wrap;
}

.property-tag {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    color: #2c3e50;
    padding: clamp(4px, 1vw, 6px) clamp(8px, 2vw, 12px);
    border-radius: 20px;
    font-size: clamp(10px, 2vw, 12px);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    white-space: nowrap;
}

.type-tag {
    background: var(--primary-gradient);
    color: white;
    border: none;
}

.property-favorite {
    position: absolute;
    inset-block-start: var(--gap-small);
    inset-inline-end: var(--gap-small);
    z-index: 2;
}

.favorite-btn {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    inline-size: clamp(40px, 8vw, 44px);
    block-size: clamp(40px, 8vw, 44px);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    touch-action: manipulation;
}

.favorite-btn:hover {
    background: white;
    transform: scale(1.1);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

/* Property Details */
.property-details {
    padding: var(--card-padding);
}

.property-details h3 {
    font-size: clamp(1.1rem, 3vw, 1.4rem);
    font-weight: 700;
    margin-block-end: var(--gap-small);
    color: #2c3e50;
    line-height: 1.3;
    word-wrap: break-word;
}

.property-location {
    display: flex;
    align-items: center;
    gap: var(--gap-small);
    margin-block-end: clamp(16px, 3vw, 20px);
    color: #6c757d;
    font-weight: 500;
    font-size: clamp(14px, 2.5vw, 16px);
}

.property-location i {
    background: var(--secondary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-size: clamp(14px, 2.5vw, 16px);
    flex-shrink: 0;
}

.property-specs {
    display: flex;
    flex-wrap: wrap;
    gap: clamp(8px, 2vw, 16px);
    margin-block-end: var(--gap-medium);
}

.spec {
    display: flex;
    align-items: center;
    gap: var(--gap-small);
    color: #495057;
    font-size: clamp(12px, 2vw, 14px);
    font-weight: 500;
    background: #f8f9fa;
    padding: clamp(6px, 1.5vw, 8px) clamp(8px, 2vw, 12px);
    border-radius: 8px;
    border: 1px solid rgba(0, 0, 0, 0.05);
    white-space: nowrap;
    flex-shrink: 0;
}

.spec i {
    color: #6c757d;
    font-size: clamp(12px, 2vw, 14px);
    flex-shrink: 0;
}

.property-price {
    margin-block-end: var(--gap-medium);
    padding: clamp(16px, 3vw, 20px);
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 12px;
    border: 1px solid rgba(0, 0, 0, 0.05);
}

.property-price h4 {
    font-size: clamp(1rem, 2.5vw, 1.3rem);
    font-weight: 700;
    margin-block-end: clamp(6px, 1.5vw, 8px);
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1.3;
    word-wrap: break-word;
}

.property-price span {
    color: #6c757d;
    font-weight: 500;
    text-transform: uppercase;
    font-size: clamp(10px, 2vw, 12px);
    letter-spacing: 0.5px;
}

/* Action Buttons */
.property-actions {
    display: flex;
    gap: clamp(8px, 2vw, 12px);
    flex-wrap: wrap;
}

.btn-view, .btn-inquire {
    flex: 1 1 min(120px, 100%);
    min-inline-size: min(120px, 100%);
    padding: clamp(12px, 3vw, 14px) clamp(16px, 4vw, 20px);
    border-radius: 12px;
    text-decoration: none;
    font-weight: 600;
    text-align: center;
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    border: 2px solid transparent;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--gap-small);
    font-size: clamp(12px, 2.5vw, 14px);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
    touch-action: manipulation;
}

.btn-view {
    background: transparent;
    color: #6c757d;
    border-color: #e9ecef;
}

.btn-view:hover {
    background: #f8f9fa;
    color: #495057;
    border-color: #dee2e6;
}

.btn-inquire {
    background: var(--primary-gradient);
    color: white;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.btn-inquire:hover {
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    color: white;
}

/* No Results */
.no-results {
    text-align: center;
    padding: var(--section-padding) var(--container-padding);
    animation: fadeInUp 0.8s ease-out;
}

.no-results i {
    font-size: clamp(3rem, 8vw, 4rem);
    background: var(--secondary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-block-end: var(--gap-medium);
    display: block;
    animation: heartPulse 2s infinite;
}

.no-results h3 {
    font-size: clamp(1.5rem, 4vw, 2rem);
    font-weight: 700;
    margin-block-end: var(--gap-small);
    color: #2c3e50;
    line-height: 1.3;
}

.no-results p {
    font-size: clamp(1rem, 2.5vw, 1.1rem);
    color: #6c757d;
    margin-block-end: var(--gap-large);
    max-inline-size: min(500px, 100%);
    margin-inline: auto;
    line-height: 1.6;
}

.btn-reset-filters {
    background: var(--primary-gradient);
    color: white;
    padding: clamp(14px, 3vw, 16px) clamp(24px, 5vw, 32px);
    border-radius: 12px;
    text-decoration: none;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: clamp(8px, 2vw, 12px);
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: clamp(12px, 2.5vw, 14px);
    touch-action: manipulation;
}

.btn-reset-filters:hover {
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    color: white;
}

/* Grid Stagger Animation */
.properties-grid .property-card:nth-child(1) { animation-delay: 0.1s; }
.properties-grid .property-card:nth-child(2) { animation-delay: 0.2s; }
.properties-grid .property-card:nth-child(3) { animation-delay: 0.3s; }
.properties-grid .property-card:nth-child(4) { animation-delay: 0.4s; }
.properties-grid .property-card:nth-child(5) { animation-delay: 0.5s; }
.properties-grid .property-card:nth-child(6) { animation-delay: 0.6s; }

/* Loading Animation */
@keyframes shimmer {
    0% { background-position: -200px 0; }
    100% { background-position: calc(200px + 100%) 0; }
}

.loading-shimmer {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200px 100%;
    animation: shimmer 1.5s infinite;
}

/* Focus Styles for Accessibility */
.favorite-btn:focus-visible,
.btn-view:focus-visible,
.btn-inquire:focus-visible,
.view-btn:focus-visible,
.toast-close:focus-visible {
    outline: 3px solid #667eea;
    outline-offset: 2px;
}

/* Reduced Motion Support */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
    
    .property-card:hover {
        transform: none;
    }
    
    .favorite-btn:hover i {
        animation: none;
    }
    
    .floating-element,
    .gradient-orb,
    .heart-pop {
        animation: none !important;
    }
}

/* Print Styles */
@media print {
    .toast-container,
    .favorite-btn,
    .property-actions,
    .animated-background {
        display: none !important;
    }
    
    .property-card {
        box-shadow: none;
        border: 1px solid #ccc;
        break-inside: avoid;
    }
    
    .hero-section {
        background: #f8f9fa !important;
        color: #000 !important;
    }
}

/* Dark Mode Support */
@media (prefers-color-scheme: dark) {
    :root {
        --card-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        --card-hover-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    }
    
    .property-card {
        background: #1a1a1a;
        border-color: rgba(255, 255, 255, 0.1);
    }
    
    .property-details h3 {
        color: #ffffff;
    }
    
    .property-location {
        color: #cccccc;
    }
    
    .spec {
        background: #2a2a2a;
        color: #ffffff;
        border-color: rgba(255, 255, 255, 0.1);
    }
    
    .breadcrumb-section {
        background-color: #1a1a1a;
        border-block-end-color: rgba(255, 255, 255, 0.1);
    }
}

/* High DPI Displays */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .property-image img {
        image-rendering: -webkit-optimize-contrast;
        image-rendering: crisp-edges;
    }
}
</style>

<div class="breadcrumb-section">
    <div class="container">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="{% url 'home' %}">
              <i class="bi bi-house-door-fill breadcrumb-home-icon"></i>Home
            </a>
          </li>
          <li class="breadcrumb-item active" aria-current="page">
            My Favorites
          </li>
        </ol>
      </nav>
    </div>
</div>

<!-- Properties Section -->
<section class="properties-section">
    <div class="container">
        <div class="properties-found">
            <p>You have <span class="count">{{ properties|length }}</span> favorite properties</p>
        </div>

        {% if properties %}
        <div class="row grid-view" id="properties-container">
            {% for property in properties %}
            <div class="col-md-6 col-lg-4">
                <div class="property-card">
                    <div class="property-image">
                        <img src="{{ property.image.url }}" alt="{{ property.project_name }}">
                        <div class="property-tags">
                            <span class="property-tag type-tag">{{ property.get_property_type_display }}</span>
                            {% if property.status %}
                            <span class="property-tag status-tag">{{ property.get_status_display }}</span>
                            {% endif %}
                        </div>
                        <div class="property-favorite">
                            <button class="favorite-btn active" data-property-id="{{ property.id }}" aria-label="Remove from favorites">
                                <i class="bi bi-heart-fill"></i>
                            </button>
                        </div>
                    </div>
                    <div class="property-details">
                        <h3>{{ property.project_name }}</h3>
                        <div class="property-location">
                            <i class="bi bi-geo-alt"></i>
                            <span>{{ property.locations.name }}</span>
                        </div>
                        <div class="property-specs">
                            <div class="spec">
                                <i class="bi bi-rulers"></i>
                                <span>{{ property.area }} sqft</span>
                            </div>
                            {% if property.configuration %}
                            <div class="spec">
                                <i class="bi bi-building"></i>
                                <span>{{ property.get_configuration_display }}</span>
                            </div>
                            {% endif %}
                            {% if property.furnishing %}
                            <div class="spec">
                                <i class="bi bi-box-seam"></i>
                                <span>{{ property.get_furnishing_display }}</span>
                            </div>
                            {% endif %}
                        </div>
                        <div class="property-price">
                            <h4>₹{{ property.min_budget }} {{ property.get_min_budget_unit_display }} - ₹{{ property.max_budget }} {{ property.get_max_budget_unit_display }}</h4>
                            <span>{{ property.get_status_display }}</span>
                        </div>
                        <div class="property-actions">
                            <a href="{% url 'property:property_detail' property.id %}" class="btn-view">
                                <i class="bi bi-eye"></i> View
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="no-results">
            <i class="bi bi-heart"></i>
            <h3>No Favorite Properties Yet</h3>
            <p>You haven't added any properties to your favorites list. Browse our properties and click the heart icon to add them here.</p>
            <a href="{% url 'property:property_home' %}" class="btn-reset-filters">
                <i class="bi bi-search"></i> Browse Properties
            </a>
        </div>
        {% endif %}
    </div>
</section>

<!-- Toast Container -->
<div class="toast-container" id="toast-container"></div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, initializing favorites functionality...');
    
    // Enhanced Toast Notification System
    function showToast(message, type = 'info') {
        console.log('Showing toast:', message, type);
        const toastContainer = document.getElementById('toast-container');
        if (!toastContainer) {
            console.error('Toast container not found!');
            return;
        }
        
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        
        const iconMap = {
            success: 'bi-check-circle-fill',
            error: 'bi-x-circle-fill',
            info: 'bi-info-circle-fill'
        };
        
        toast.innerHTML = `
            <div class="toast-content">
                <i class="bi ${iconMap[type] || iconMap.info}"></i>
                <span>${message}</span>
            </div>
            <span class="toast-close">&times;</span>
        `;
        
        toastContainer.appendChild(toast);
        
        // Trigger animation
        setTimeout(() => toast.classList.add('show'), 100);
        
        // Auto remove after 4 seconds
        const autoRemove = setTimeout(() => removeToast(toast), 4000);
        
        // Manual close
        toast.querySelector('.toast-close').addEventListener('click', () => {
            clearTimeout(autoRemove);
            removeToast(toast);
        });
    }
    
    function removeToast(toast) {
        toast.classList.remove('show');
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 300);
    }

    // Utility function to get CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    
    // DEBUG: Check if favorite buttons exist
    const favoriteButtons = document.querySelectorAll('.favorite-btn');
    console.log('Found favorite buttons:', favoriteButtons.length);
    
    if (favoriteButtons.length === 0) {
        console.warn('No favorite buttons found! Check your HTML structure.');
        return;
    }
    
    // Enhanced Favorite Handling with Animations and DEBUG
    favoriteButtons.forEach((button, index) => {
        console.log(`Setting up favorite button ${index}:`, button);
        console.log(`Button property ID: ${button.dataset.propertyId}`);
        
        // Add visual feedback for debugging
        button.style.cursor = 'pointer';
        button.addEventListener('mouseenter', function() {
            console.log('Mouse entered favorite button');
            this.style.opacity = '0.8';
        });
        
        button.addEventListener('mouseleave', function() {
            this.style.opacity = '1';
        });
        
        button.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            console.log('Favorite button clicked!');
            console.log('Event target:', e.target);
            console.log('Current target:', e.currentTarget);
            
            const propertyId = this.dataset.propertyId;
            console.log('Property ID:', propertyId);
            
            if (!propertyId) {
                console.error('Property ID not found in button data!');
                showToast('Error: Property ID not found', 'error');
                return;
            }
            
            const heartIcon = this.querySelector('i');
            console.log('Heart icon found:', heartIcon);
            
            // Add loading state
            this.style.pointerEvents = 'none';
            if (heartIcon) {
                heartIcon.style.opacity = '0.6';
            }
            
            // Show immediate feedback
            showToast('Processing...', 'info');
            
            console.log('Making AJAX request to:', `/favorite/${propertyId}/`);
            
            // Send AJAX request to toggle favorite
            fetch(`/favorite/${propertyId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                credentials: 'same-origin'
            })
            .then(response => {
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return response.json();
            })
            .then(data => {
                console.log('Response data:', data);
                
                if (data.success) {
                    // Check if we're on the favorites page
                    const isOnFavoritesPage = window.location.pathname.includes('my-favorites') || 
                                            window.location.pathname.includes('favorites');
                    
                    console.log('Is on favorites page:', isOnFavoritesPage);
                    
                    if (isOnFavoritesPage) {
                        // Find the parent property card element
                        const propertyCard = button.closest('.col-md-6') || 
                                           button.closest('.col-lg-4') || 
                                           button.closest('.property-card').closest('div');
                        
                        console.log('Property card to remove:', propertyCard);
                        
                        if (propertyCard) {
                            // Add exit animation
                            propertyCard.style.transform = 'scale(0.8)';
                            propertyCard.style.opacity = '0';
                            propertyCard.style.transition = 'all 0.4s ease';
                            
                            setTimeout(() => {
                                propertyCard.remove();
                                
                                // Update the count with animation
                                const countElement = document.querySelector('.properties-found .count');
                                console.log('Count element:', countElement);
                                
                                if (countElement) {
                                    const currentCount = parseInt(countElement.textContent);
                                    console.log('Current count:', currentCount);
                                    
                                    countElement.style.transform = 'scale(1.2)';
                                    countElement.style.transition = 'transform 0.2s ease';
                                    
                                    setTimeout(() => {
                                        countElement.textContent = currentCount - 1;
                                        countElement.style.transform = 'scale(1)';
                                        
                                        // Check if no favorites left
                                        if (currentCount - 1 === 0) {
                                            console.log('No favorites left, showing empty state');
                                            // Show no results message
                                            setTimeout(() => {
                                                const containerElement = document.querySelector('.properties-section .container');
                                                if (containerElement) {
                                                    containerElement.innerHTML = `
                                                        <div class="section-header">
                                                            <h2>My Favorite Properties</h2>
                                                            <p>Properties you've saved as favorites</p>
                                                        </div>
                                                        <div class="no-results">
                                                            <i class="bi bi-heart"></i>
                                                            <h3>No Favorite Properties Yet</h3>
                                                            <p>You haven't added any properties to your favorites list. Browse our properties and click the heart icon to add them here.</p>
                                                            <a href="/properties/" class="btn-reset-filters">
                                                                <i class="bi bi-search"></i> Browse Properties
                                                            </a>
                                                        </div>
                                                    `;
                                                }
                                            }, 500);
                                        }
                                    }, 100);
                                }
                            }, 400);
                            
                            showToast(data.message || 'Property removed from favorites', 'success');
                        } else {
                            console.error('Could not find property card to remove');
                            showToast('Error: Could not remove property from page', 'error');
                        }
                    } else {
                        // If not on favorites page, just update the heart icon
                        if (data.is_favorite) {
                            this.classList.add('active');
                            if (heartIcon) {
                                heartIcon.classList.remove('bi-heart');
                                heartIcon.classList.add('bi-heart-fill');
                            }
                            showToast('Added to favorites', 'success');
                        } else {
                            this.classList.remove('active');
                            if (heartIcon) {
                                heartIcon.classList.remove('bi-heart-fill');
                                heartIcon.classList.add('bi-heart');
                            }
                            showToast('Removed from favorites', 'success');
                        }
                        
                        // Restore button state
                        this.style.pointerEvents = 'auto';
                        if (heartIcon) {
                            heartIcon.style.opacity = '1';
                        }
                    }
                } else {
                    console.error('Server returned success: false', data);
                    showToast(data.error || 'Failed to update favorites', 'error');
                    // Restore button state
                    this.style.pointerEvents = 'auto';
                    if (heartIcon) {
                        heartIcon.style.opacity = '1';
                    }
                }
            })
            .catch(error => {
                console.error('Fetch error:', error);
                showToast('Network error: ' + error.message, 'error');
                // Restore button state
                this.style.pointerEvents = 'auto';
                if (heartIcon) {
                    heartIcon.style.opacity = '1';
                }
            });
        });
    });
    
    // Additional debugging: Check if CSRF token exists
    const csrfToken = getCookie('csrftoken');
    console.log('CSRF token found:', !!csrfToken);
    if (!csrfToken) {
        console.warn('CSRF token not found! This might cause issues with POST requests.');
    }
    
    // Test click handler
    console.log('Favorites functionality initialized successfully!');
});

document.addEventListener('DOMContentLoaded', function() {
    const animatedBg = document.getElementById('animatedBg');
    
    if (!animatedBg) {
        console.log('Animated background element not found, skipping animation setup');
        return;
    }
    
    const heroSection = document.querySelector('.hero-section');
    
    // Function to create floating elements
    function createFloatingElement(type, className, icon) {
        const element = document.createElement('i');
        element.className = `bi ${icon} floating-element ${className}`;
        
        // Random positioning
        element.style.left = Math.random() * 100 + '%';
        element.style.top = Math.random() * 100 + '%';
        
        // Random animation delay
        element.style.animationDelay = Math.random() * 10 + 's';
        
        return element;
    }
    
    // Function to populate background with floating elements
    function populateBackground() {
        const elements = [
            // Hearts (most prominent)
            { type: 'heart', class: 'floating-heart', icon: 'bi-heart', count: 12 },
            { type: 'heart', class: 'floating-heart small', icon: 'bi-heart-fill', count: 8 },
            { type: 'heart', class: 'floating-heart large', icon: 'bi-heart', count: 6 },
            
            // House icons
            { type: 'house', class: 'floating-house', icon: 'bi-house-heart', count: 8 },
            { type: 'house', class: 'floating-house', icon: 'bi-house-door', count: 6 },
            
            // Stars
            { type: 'star', class: 'floating-star', icon: 'bi-star', count: 10 },
            { type: 'star', class: 'floating-star', icon: 'bi-star-fill', count: 8 },
            
            // Keys
            { type: 'key', class: 'floating-key', icon: 'bi-key', count: 5 },
            { type: 'key', class: 'floating-key', icon: 'bi-key-fill', count: 4 }
        ];
        
        elements.forEach(elementType => {
            for (let i = 0; i < elementType.count; i++) {
                const element = createFloatingElement(
                    elementType.type,
                    elementType.class,
                    elementType.icon
                );
                animatedBg.appendChild(element);
            }
        });
    }
    
    // Function to create heart pop effect
    function createHeartPop(x, y) {
        const heartPop = document.createElement('i');
        heartPop.className = 'bi bi-heart-fill heart-pop';
        heartPop.style.left = x + 'px';
        heartPop.style.top = y + 'px';
        
        animatedBg.appendChild(heartPop);
        
        // Remove after animation
        setTimeout(() => {
            if (heartPop.parentNode) {
                heartPop.parentNode.removeChild(heartPop);
            }
        }, 2000);
    }
    
    // Add click handler for heart pop effects
    if (heroSection) {
        heroSection.addEventListener('click', function(e) {
            const rect = heroSection.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Create multiple heart pops
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    createHeartPop(
                        x + (Math.random() - 0.5) * 100,
                        y + (Math.random() - 0.5) * 100
                    );
                }, i * 200);
            }
        });
    }
    
    // Initialize background
    populateBackground();
    
    // Add occasional random heart pops
    function randomHeartPop() {
        if (Math.random() > 0.7 && heroSection) { // 30% chance
            const rect = heroSection.getBoundingClientRect();
            createHeartPop(
                Math.random() * rect.width,
                Math.random() * rect.height
            );
        }
        
        // Schedule next random pop
        setTimeout(randomHeartPop, Math.random() * 5000 + 3000); // 3-8 seconds
    }
    
    // Start random heart pops
    setTimeout(randomHeartPop, 2000);
    
    // Refresh floating elements periodically to prevent performance issues
    setInterval(() => {
        // Remove old elements
        const oldElements = animatedBg.querySelectorAll('.floating-element');
        oldElements.forEach(el => {
            if (Math.random() > 0.8) { // Remove 20% randomly
                el.remove();
            }
        });
        
        // Add new ones if needed
        const currentCount = animatedBg.querySelectorAll('.floating-element').length;
        if (currentCount < 50) {
            const newElement = createFloatingElement(
                'heart',
                'floating-heart',
                Math.random() > 0.5 ? 'bi-heart' : 'bi-heart-fill'
            );
            animatedBg.appendChild(newElement);
        }
    }, 10000); // Every 10 seconds
    
    console.log('Animated background initialized with floating elements!');
});
</script>
{% endblock %}